---
import Layout from '../layouts/Layout.astro';
import Redirects from '../pages/Redirects.astro';
import About from '../pages/about.astro';
import Moving from './Moving.astro';

const commitHash = import.meta.env.VERCEL_GIT_COMMIT_SHA
  ? import.meta.env.VERCEL_GIT_COMMIT_SHA.slice(0, 7)
  : "dev";

const commitDateRaw = import.meta.env.VERCEL_GIT_COMMIT_TIMESTAMP
  ? new Date(import.meta.env.VERCEL_GIT_COMMIT_TIMESTAMP).toISOString().split("T")[0]
  : new Date().toISOString().split("T")[0];

const date = new Date(commitDateRaw);
const commitDate = date.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---
<Layout title="home">
  <div class="flex flex-col min-h-screen">
    <header><b>hey, i'm sarvesh!</b></header>

    <div class="container">
      <h1 class="text-center text-3xl text-white">welcome to my home!</h1>
    </div>

    <main class="flex-grow">
      <Moving />

      <div class="mt-12 mx-5 gap-8">
        <div class="p-12 py-4 bg-gradient-to-br from-blue-400 via-blue-500 to-blue-700 border-4 border-blue-900 justify-center items-center flex flex-col text-xl text-white">
          <Redirects />
        </div>

        <br>
		<div class="card-3d">
        	<div class="p-12 py-4 bg-gradient-to-br from-blue-400 via-blue-500 to-blue-700 border-4 border-blue-900 justify-center flex flex-col text-lg text-white">
            <About />
        </div>
        </div>
      </div>
    </main>

    <footer class="text-center">
      <span class="lowercase">by sarvesh, Last updated: {commitDate} (commit {commitHash})</span>
    </footer>
  </div>

  <script type="module" client:load>
    document.querySelectorAll(".card-3d").forEach(card => {
      let cx = 0, cy = 0, tx = 0, ty = 0;
      const max = 7, ease = 0.1, depth = 10;

      const loop = () => {
        cx += (tx - cx) * ease;
        cy += (ty - cy) * ease;
        card.style.transform = `
          perspective(1200px)
          rotateX(${cx}deg)
          rotateY(${cy}deg)
          translateZ(${depth}px)
        `;
        requestAnimationFrame(loop);
      };

      loop();

      card.addEventListener("mousemove", e => {
        const r = card.getBoundingClientRect();
        tx = -((e.clientY - r.top) / r.height - 0.5) * max;
        ty = ((e.clientX - r.left) / r.width - 0.5) * max;
      });

      card.addEventListener("mouseleave", () => { tx = 0; ty = 0; });
    });
  </script>
</Layout>